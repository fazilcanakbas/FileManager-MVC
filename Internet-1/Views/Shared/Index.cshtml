@model List<Ideas>

@{
    ViewData["Title"] = "Fikirler";
    Layout = "~/Views/Shared/_LayoutAdmin.cshtml";
}

@section CardHeader {
    <span>Fikir Panosu</span>
}

<div class="row">
    <div class="col-md-8">
        <table class="table" id="tbIdeas">
            <thead>
                <tr>
                    <th>Başlık</th>
                    <th>İçerik</th>
                    <th>Kategori</th>
                    <th>Beğeni</th>
                    <th>Yorumlar</th>
                    <th>Düzenle</th>
                </tr>
            </thead>
            <tbody>
                @if (Model != null && Model.Any())
                {
                    @foreach (var idea in Model)
                    {
                        <tr>
                            <td>@idea.Title</td>
                            <td>@idea.Description</td>
                            <td>@idea.Category</td>
                            <td>@idea.Likes</td>
                            <td>
                                <!-- Yorumlar kısmı eklenebilir -->
                            </td>
                            <td>
                                <button class="btn btn-sm btn-primary" onclick="openEditForm(@idea.Id)">Düzenle</button>
                            </td>
                        </tr>
                    }
                }
                else
                {
                    <tr>
                        <td colspan="6">Hiç fikir bulunamadı.</td>
                    </tr>
                }
            </tbody>
        </table>
    </div>

    <div class="col-md-4">
        <h5 id="editTitle">Yeni Fikir</h5>
        <div class="mb-3">
            <label>Başlık</label>
            <input type="text" class="form-control" id="txtTitle" />
            <input type="hidden" id="txtId" />
        </div>
        <div class="mb-3">
            <label>İçerik</label>
            <textarea rows="3" class="form-control" id="txtContent"></textarea>
        </div>
        <div class="mb-3">
            <label>Kategori</label>
            <select class="form-control" id="txtCategory">
                <option value="Technology">Teknoloji</option>
                <option value="Entertainment">Eğlence</option>
                <option value="Business">İş Dünyası</option>
            </select>
        </div>
        <div class="mb-3">
            <button class="btn btn-primary btn-sm" id="btnSave">Kaydet</button>
            <button class="btn btn-secondary btn-sm" id="btnCancel">Vazgeç</button>
        </div>
    </div>
</div>

@section Scripts {
    <script>
        $(document).ready(function () {
            GetIdeasList();
            $("#btnCancel").hide();
            $("#btnDelete").hide();
            $("#txtId").val(0);

            $("#btnSave").click(function () {
                const id = $("#txtId").val();
                const title = $("#txtTitle").val();
                const description = $("#txtDescription").val();
                const category = $("#txtCategory").val();
                const likes = $("#txtLikes").val();
                const idea = { Id: id, Title: title, Description: description, Category: category, Likes: likes };
                
                $.ajax({
                    url: "/Ideas/AddUpdateAjax",
                    type: "POST",
                    data: idea,
                    success: function (d) {
                        if (d.status) {
                            GetIdeasList();
                            ResetForm();
                            ShowMessage("success", d.message);
                        } else {
                            ShowMessage("danger", d.message);
                        }
                    },
                    error: function () {
                        ShowMessage("danger", "Hata oluştu!");
                    },
                });
            });

            $(document).on("click", ".edit", function () {
                const id = $(this).data("id");
                $("#editTitle").html("Fikir Düzenle");
                $("#btnCancel").show();
                $("#btnDelete").show();
                $.ajax({
                    url: `/Ideas/GetByIdAjax/${id}`,
                    type: "GET",
                    success: function (d) {
                        $("#txtId").val(d.id);
                        $("#txtTitle").val(d.title);
                        $("#txtDescription").val(d.description);
                        $("#txtCategory").val(d.category);
                        $("#txtLikes").val(d.likes);
                    },
                });
            });

            $("#btnCancel").click(function () {
                ResetForm();
            });

            $("#btnDelete").click(function () {
                const id = $("#txtId").val();
                $.ajax({
                    url: `/Ideas/DeleteAjax/${id}`,
                    type: "DELETE",
                    success: function (d) {
                        if (d.status) {
                            GetIdeasList();
                            ResetForm();
                            ShowMessage("success", d.message);
                        } else {
                            ShowMessage("danger", d.message);
                        }
                    },
                });
            });

            function GetIdeasList() {
                $.ajax({
                    url: "/Ideas/ListAjax",
                    type: "GET",
                    success: function (data) {
                        IdeasToTable(data);
                    },
                });
            }

            function IdeasToTable(data) {
                $("#tbIdeas tbody").empty();
                let rows = "";
                data.forEach((item) => {
                    rows += `
                        <tr>
                            <td>${item.title}</td>
                            <td>${item.description}</td>
                            <td>${item.category}</td>
                            <td>${item.likes}</td>
                            <td>
                                <button class='btn btn-primary btn-sm edit' data-id='${item.id}'>Düzenle</button>
                            </td>
                            <td>
                                <button class='btn btn-danger btn-sm delete' data-id='${item.id}'>Sil</button>
                            </td>
                        </tr>
                    `;
                });
                $("#tbIdeas tbody").append(rows);
            }

            function ResetForm() {
                $("#editTitle").html("Yeni Fikir");
                $("#btnCancel").hide();
                $("#btnDelete").hide();
                $("#txtId").val(0);
                $("#txtTitle").val("");
                $("#txtDescription").val("");
                $("#txtCategory").val("");
                $("#txtLikes").val("");
            }

            function ShowMessage(type, message) {
                $("#divResult")
                    .show()
                    .removeClass()
                    .addClass(`alert alert-${type}`)
                    .html(message)
                    .fadeOut(3000);
            }
        });
    </script>
}
